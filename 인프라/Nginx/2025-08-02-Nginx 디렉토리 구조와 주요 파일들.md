# Nginx 디렉토리 구조와 주요 파일들

## 주요 디렉토리 구조 (Ubuntu/Debian 기준)

```
/etc/nginx/
├── nginx.conf              # 메인 설정 파일
├── sites-available/        # 사용 가능한 사이트 설정들
├── sites-enabled/          # 활성화된 사이트 설정들 (심볼릭 링크)
├── conf.d/                 # 추가 설정 파일들
├── modules-available/      # 사용 가능한 모듈들
├── modules-enabled/        # 활성화된 모듈들
└── snippets/               # 재사용 가능한 설정 조각들

/var/log/nginx/
├── access.log             # 접근 로그
└── error.log              # 에러 로그

/var/www/html/             # 기본 웹 루트 디렉토리

/usr/share/nginx/html/     # nginx 기본 페이지 (CentOS/RHEL)
```

### 주요 파일 설명

`/etc/nginx/nginx.conf`

- nginx의 메인 설정 파일
- 전역 설정과 기본값들을 정의

`/etc/nginx/sites-available/`

- 모든 가상 호스트 설정 파일들을 저장
- 비활성 상태의 설정들도 포함

`/etc/nginx/sites-enabled/`

- 실제로 활성화된 사이트 설정들
- sites-available에서 심볼릭 링크로 연결

## nginx.conf 기본 구조

```nginx
# 전역 설정
user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log;

# 이벤트 블록
events {
    worker_connections 1024;
}

# HTTP 블록
http {
    # HTTP 전역 설정
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    # 로그 형식 정의
    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for"';

    access_log /var/log/nginx/access.log main;

    # 서버 블록 (가상 호스트)
    server {
        listen 80;
        server_name localhost;
        root /var/www/html;
        index index.html;

        # 위치 블록
        location / {
            try_files $uri $uri/ =404;
        }
    }

    # 추가 설정 파일 포함
    include /etc/nginx/conf.d/*.conf;
    include /etc/nginx/sites-enabled/*;
}
```

### 설정 블록 계층 구조

```
main (전역)
├── events
└── http
    ├── upstream
    ├── server (가상 호스트)
    │   └── location
    └── server
        └── location
```

### 주요 디렉티브 설명

**전역 디렉티브:**

- user: nginx 워커 프로세스 실행 사용자
- worker_processes: 워커 프로세스 개수 (보통 CPU 코어 수)
- error_log: 에러 로그 파일 위치

**events 블록:**

- worker_connections: 각 워커 프로세스의 최대 동시 연결 수

**http 블록:**

- include: 다른 설정 파일 포함
- server_name: 도메인 이름
- listen: 수신 포트
- root: 웹 루트 디렉토리
- index: 기본 인덱스 파일

**location 블록:**

- URL 패턴에 따른 요청 처리 규칙 정의

### 설정 문법 규칙

1. 세미콜론(;): 모든 디렉티브는 세미콜론으로 끝남
2. 중괄호({}): 블록의 시작과 끝을 표시
3. 주석(#): # 이후 줄 끝까지 주석 처리
4. 변수($): $variable_name 형태로 변수 사용
5. 문자열: 공백이 포함된 값은 따옴표로 감쌈

### 설정 테스트

```bash
# 설정 파일 문법 검사
sudo nginx -t

# 설정 적용
sudo systemctl reload nginx
```
