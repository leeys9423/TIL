# 서버(Server)

## 정의

네트워크상에서 **클라이언트의 요청**을 받아 **서비스나 리소스를 제공**하는 컴퓨터 시스템

구체적으로:

1. 하드웨어 관점: 높은 처리 능력과 안정성을 갖춘 물리적 컴퓨터
2. 소프트웨어 관점: 특정 서비스를 제공하는 프로그램이나 프로세스

## 핵심

클라이언트-서버 모델에서 요청을 처리하는 것

1. 웹 서버는 HTTP 요청을 받아 HTML 페이지를 응답으로 제공
2. 데이터베이스 서버는 SQL 쿼리를 처리하여 데이터를 반환
3. 파일 서버는 파일 공유 서비스
4. 메일 서버는 이메일 송수신 서비스를 담당

## 서버와 클라이언트 간의 데이터 통신

TCP/IP 프로토콜을 기반으로 통신이 이루어짐. 클라이언트가 서버에 연결하려면 서버의 IP 주소와 포트 번호를 알아야 합니다.

### TCP/IP 프로토콜

TCP/IP는 두 개의 프로토콜이 결합된 것.

우편시스템에 비유:

1. **IP(Internet Protocol):** 우편 주소 체계와 같습니다. 전 세계 어디든 편지를 보낼 수 있도록 표준화된 주소 형식이 있는 것처럼, IP는 인터넷상의 모든 컴퓨터에게 고유한 주소를 부여합니다. IP의 역할은 데이터 패킷을 목적지까지 라우팅하는 것입니다. 하지만 IP만으로는 데이터가 제대로 도착했는지, 순서가 맞는지 확인할 수 없습니다.
2. **TCP(Transmission Control Protocol):** IP에서 말씀드렸다시피 IP의 역할은 데이터 패킷을 목적지까지 라우팅하는 것입니다. 즉 데이터 패킷의 도착을 알 수 없습니다. 이러한 이유 때문에, TCP가 등장했고, 다시 우편시스템에 비유해보자면 편지가 제대로 도착했는지 확인하고, 만약 분실되면 다시 보내달라고 요청하며, 여러 개의 편지가 순서대로 도착하도록 관리합니다. 즉, TCP는 연결을 설정하고, 데이터의 신뢰성을 보장하며, 흐름 제어와 오류 검출을 담당합니다.

> TCP 연결은 3-way handshake 과정을 거칩니다.
> 클라이언트가 서버에게 "연결하고 싶어요"라고 SYN 메시지를 보내면, 서버는 "알겠어요. 저도 준비됐어요" 라는 의미의 SYN-ACK를 응답합니다
> 마지막으로 클라이언트가 "좋아요, 이제 시작하죠"라는 ACK를 보내면 연결이 완료됩니다.
>
> TCP 해제는 4-way handshake 과정을 거칩니다.
> 클라이언트가 더 이상 데이터를 보낼 것이 없다고 판단하면, 서버에게 FIN 플래그가 설정된 패킷을 보냅니다. 이는 "나는 데이터 전송을 끝내고 싶어"라는 의미입니다. 하지만 여기서 중요한 점은 클라이언트가 여전히 서버로부터 데이터를 받을 준비는 되어 있다는 것입니다.
> 두 번째 단계에서 서버는 클라이언트의 FIN을 받았다는 확인 응답으로 ACK 패킷을 보냅니다.
> 하지만 서버는 아직 자신의 데이터 전송을 완료하지 못했을 수도 있습니다. 따라서 서버는 남은 데이터를 계속 보낼 수 있습니다.
> 세 번째 단계에서 서버가 자신의 데이터 전송을 모두 완료하면, 이제 서버도 FIN 패킷을 클라이언트에게 보냅니다.
> 마지막 네 번째 단계에서 클라이언트는 서버의 FIN에 대한 확인 응답으로 ACK를 보냅니다. 여기서 흥미로운 점이 하나 있습니다. 클라이언트는 이 ACK를 보낸 후에도 즉시 연결을 완전히 닫지 않습니다. 대신 TIME_WAIT 상태로 들어가서 일정 시간을 기다립니다.
> TIME_WAIT가 필요한 이유는 네트워크에서 패킷이 지연되거나 중복될 수 있습니다. ACK 이후 연결을 완전히 닫아버린다면, 서버의 FIN이 재전송되었을 때 이를 처리할 수 없습니다.

### DNS(Domain Name System)

클라이언트가 서버에 연결하려면 서버의 IP 주소와 포트번호를 알아야 한다고 했습니다. 하지만 우리는 네이버와 구글과 같은 사이트에 접속을 하기 위해서 IP 주소 + 포트번호 대신에 www.naver.com 혹은 www.google.com이라는 도메인 주소로 요청하곤 합니다.

그러면 다시 돌아가 어떻게 하면 www.naver.com 혹은 www.google.com 이라는 주소로도 접속이 가능할까요? 이건 DNS의 역할입니다.

DNS는 도메인 이름을 IP 주소로 변환해줍니다.

이 과정을 단계별로 따라가보면, 사용자가 브라우저에 naver.com을 입력하면, 컴퓨터는 먼저 로컬 DNS 캐시를 확인합니다. 거기에 없으면 설정된 DNS 서버(보통 인터넷 서비스 제공업체의 DNS)에 질의 합니다. 해당 DNS 서버도 모르면 루트 DNS 서버부터 시작해서 계층적으로 질의를 올라가면서 최종적으로 IP 주소를 찾아냅니다.
