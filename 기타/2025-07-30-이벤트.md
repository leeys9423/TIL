# 이벤트 드리븐 아키텍처의 이벤트

## 이벤트란?

이벤트 드리븐 아키텍처(Event Driven Architecture)에서 **이벤트**는 시스템에서 일어난 의미 있는 상태 변화나 행동을 나타내는 불변의 데이터입니다.

## 이벤트의 핵심 특징

**불변성(Immutable)**

- 한 번 생성된 이벤트는 절대 변경되지 않습니다
- 과거에 일어난 일은 바뀔 수 없다는 현실을 반영

**명명 규칙**

- 과거형으로 명명: `UserRegistered`, `OrderCompleted`, `PaymentFailed`
- "~가 일어났다"는 사실을 표현

**구조**

```json
{
  "eventId": "uuid-1234",
  "eventType": "OrderCompleted",
  "timestamp": "2024-01-15T10:30:00Z",
  "aggregateId": "order-5678",
  "data": {
    "orderId": "order-5678",
    "customerId": "user-9012",
    "totalAmount": 50000
  }
}
```

## 이벤트 vs 명령(Command)

### 기본 차이점

| 이벤트                | 명령               |
| --------------------- | ------------------ |
| 과거에 일어난 사실    | 미래에 실행할 요청 |
| `UserRegistered`      | `RegisterUser`     |
| 불변                  | 가변 (실패 가능)   |
| 여러 컨슈머 구독 가능 | 단일 핸들러        |

### 철학적 차이

**이벤트 (Events)**

- "무엇이 일어났는지" 알림
- 발행자는 누가 구독하는지 모름 (decoupled)
- 실패해도 이미 일어난 사실은 변하지 않음
- 시간 순서가 중요

**명령 (Commands)**

- "무엇을 해달라"고 요청
- 명확한 수신자가 있음 (coupled)
- 실행 실패 가능성 존재
- 즉시 처리 기대

### 실제 예시로 보는 차이

**주문 프로세스에서**

```
명령 흐름:
RegisterUser → ValidateUser → SaveUser → PublishEvent

이벤트 흐름:
UserRegistered → [이메일발송, 쿠폰지급, 통계업데이트, ...]
```

**실패 처리**

- 명령: `RegisterUser` 실패 → 사용자 등록 안됨
- 이벤트: `UserRegistered` 발행 후 이메일 발송 실패 → 사용자는 이미 등록됨, 이메일만 재시도

### 왜 구분이 중요한가?

**확장성**

- 이벤트: 새로운 기능 추가 시 기존 코드 수정 없이 구독자만 추가
- 명령: 새로운 처리 로직 추가 시 핸들러 수정 필요

**장애 격리**

- 이벤트: 한 구독자 실패가 다른 구독자에게 영향 없음
- 명령: 핸들러 실패시 전체 요청 실패

### 혼합 사용 패턴

```
1. 명령으로 시작 → 이벤트로 확산
   RegisterUser(명령) → UserRegistered(이벤트)

2. 이벤트가 새로운 명령 트리거
   UserRegistered → SendWelcomeEmail(명령)

3. 사가 패턴에서 이벤트-명령 체인
   OrderCreated(이벤트) → ReserveInventory(명령) → InventoryReserved(이벤트) → ProcessPayment(명령)
```

## 실제 활용 예시

**전자상거래 시스템**

1. `OrderPlaced` → 재고 차감, 결제 처리
2. `PaymentCompleted` → 배송 준비, 영수증 발송
3. `OrderShipped` → 고객 알림, 배송 추적

**장점**

- 시스템 간 느슨한 결합
- 확장성과 유연성
- 장애 격리
- 비즈니스 히스토리 추적 가능

## 주의사항

- 이벤트 순서 보장 필요시 파티셔닝 고려
- 이벤트 스키마 버전 관리 중요
- 중복 처리 방지를 위한 멱등성 설계

이벤트는 단순한 데이터가 아니라 비즈니스 도메인의 중요한 사실을 담은 **1급 시민**입니다!

### 1급 시민

**정의**: 프로그래밍 언어나 시스템에서 다른 요소들과 동등한 권한과 기능을 가진 객체를 의미

쉽게 말해보자면, 단순한 데이터가 아닌 핵심 비즈니스 객체로 취급한다는 뜻!

즉, 이벤트를 **시스템의 핵심 구성 요소**로 인정하고 다른 중요한 객체들과 동등하게 취급한다는 뜻
